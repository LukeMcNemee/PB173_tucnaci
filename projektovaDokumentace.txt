TODO
Vytvořit nějaký moc krásný epos na téma: Ve jménu Snowdena bojujeme náš kryptografický boj proti sovětským agentům z KGB/GRU a proti zlovůli molochu NSA.

Projekt do PB173 - Bezpecna videokonferenci architektura
coz je jen kryci nazev pro vytvoreni neprustrelne aplikace typu Skype/Hangout... pro Edwarda Snowdena, aby mohl pokracovat ve vynaseni vsech spatnosti na zlosyny z NSA.

Motivace:
Jak uz bylo naznaceno, dnes je clovek odposlouchavan vsude. Co si programator sam nenapise, to nema nezabezpecene. A pokud se jako programatori mame domluvit na hacknuti cele NSA,
musime se domlouvat na sifrovanem kanalu bez moznosti odposlechu ze strany NSA.
Za vedlejsi cile se da povazovat cviceni implementace kryptografickych metod v "praxi" (ve vlastnim kodu C/C++) a rozvinuti schopnosti spoluprace na vetsim projektu v kolektivu.

Pouzite technologie:
C/C++ s knihovnou PolarSSL, v nasem pripade vetsinove C++, ale jelikoz je PolarSSL psana v C, tak sekce kolem sifrovani budou smesici C a C++.
Dalse planujeme pouzit knihovny pro praci se sockety/HTTPS, knihovnu pro vlakna a udalosti. Pro zpracovani obrazu a zvuku vyuzijeme doporucene knihovny ze cviceni.
Konkretneji ke kryptografii: pro zajisteni duvernosti, integrity i soukromi vyuzijeme sifrovaciho schematu encrypt-then-mac v podobe otevrene implementace Galois/Counter Mode (GCM),
ktera je dostupna v PolarSSL. Jako hashovaci funkci budeme pouzivat SHA-512, symetrickou sifrovaci funkci bude AES v jiz zminenem modu GCM a pro ustanoveni komunikace pouzijeme asymetricke
kryptografii v podobe RSA

Nas navrh pristup:
Projekt ma mit 3 hlavni tridy:
Certifikacni autorita (CA) - overuje uzivatele a vystavuje certifikaty
Klient - chce komunikovat s jinym klientem, k cemuz vyuziva sluzeb CA a serveru
Videokonferencni server - registruje klenty, udrzuje jejich seznam a
    vyrizuje zajmy o ustanoveni komunikace
Mezi temito tridami probiha ruzna komunikace. Server od uzivatele prijima zasifrovane
zpravy o registraci nebo zajmu o komunikaci s jinym klientem. Server si s CA vymenuje
verejne klice uzivatele, aby mohl vratit klientovi vratit informace k ustanoveni komunikace.
Pokud se klient registruje, pak je serverem odkazan na CA, ktere preda verejny klic.
Komunikace klient - klient probiha pomoci symetricke kryptografie. Pro potreby prenosu
videa pouzivame proudove sifry.

//Lehce upravená verze návrhu  
V projektu vystupují tři komponenty, mezi kterými je ustanovena komunikace.
Certifikační autorita (CA) je komponentou, která zajišťuje ověřování a distribuci certifikátů veřejných klíčů
potřebných pro navázání asymetricky šifrované komunikace mezi klienty. Certifikační autorita přijímá certifikáty
od nově příchozích klientů, a na žádost vydává veřejné certifikáty klientů. Pro komunikaci s CA je zřízen jeden pár
veřejného a  soukromého klíče, kerý je používán CA. Veřejný klíč je pro klienta známý. Komunikace je ustavena klientem,
který pomocí certifikátu veřejného klíče CA pošle šifrovaný a pomocí svého privátního klíče podepsaný požadavek na
získání certifikátu jiného klienta. CA jako reakci na požadovaný požadavek pošle jako odpověď na požadavek šifrovaný
certifikát veřejného klíče. 

Server je komponentou zaštiťující ustanovení komunikace mezi klienty. Komunikace probíhá pomocí jedsnosměrně šifrované
komunikace od klienta k serveru. Server přijímá od klienta požadavky na přhlášení do systému a odešle ostatním připojeným
jeho dostupnost. Následně očekává požadavky na spojení. Na konec po odpojení odešle všem klientům požadavek na smazání klienta.
Server přijme požadavek na spojení od klienta ke klientu. Tento požadavek propaguje
k cílovému klientovi společně s údaji pro navázání komunikace se zdrojovým klientem. V případě přijetí pozitivní odpovědi
odešle komunikační údaje cílového klienta zdrojovému a označí oba klienty za nedostupné. Pokud některý z klientů ukončí 
komunikaci odešle tuto informaci serveru a ten označí oba klienty za dostupné.

Komponenta klient zajiťuje rozhraní pro přímou komunikaci dvou klientů, navázání komunikace a získávání veřejných klíčů
vystupujících v komunikaci. Klient se přpojí k serveru a přijme seznam připojených klientů.

    a)  Klient požaduje připojení ke klientovi:
        Iniciální klient (IK) si vyžádá od CA veřejný klíč cílového klienta (CK) a zašle serveru požadavek na spojení.
        Po kladné odpovědi serveru a přijetí komunikačních údajů o CK. Následně navazuje komunikaci s CK. Odešle
        požadavek spoelečně s náhodně vygenerovaným klíčem a inicializačním vektorem pro symetrickou kryptografii
        zašifrovaný a podepsaný pomocí asymetrické kryptografie k CK. Pokud CK odpoví kladně, přijme a zpracuje
        symetrický klíč a inicializační vektor pro komunikaci od CK a IK je schopen pomocí
        veřejného klíče CK ověřit autenticitu. Nakonec navazuje a přijímá komunikaci k resp. od CK šifrovanou pomocí
        symetrické kryptografie. 
        
    b)  Klient přijímá požadavek na komunikaci od serveru:
        CK přijme od serveru požadavek a informace o IK. Od CA si vyžádá certifikát veřejného klíče IK a odpoví na 
        požadavek. Následně přijímá požadavek přímo od IK, které ověří pomocí jeho veřejného certifikátu. Přijme klíč 
        pro komunikaci od IK, vygeneruje a odešle klíč pro komunikaci CK -> IK. Nakonec přijímá  a otevírá přímé spojení
        mezi IK a CK.

Nase API:
Viz hlavickove soubory na GitHubu vcetne dokumentace

Pro delku 2 stranek doplnim dalsi technicke detaily:
Daleko, za Slovnímy horami, vzdálené od země samohlásek a souhlásek žijí Smyšlené texty. Opuštěné žijí v Písmenkově na pobřeží Sémantiky, velkého Jazykooceánu. Místem protéká potůček zvaný Ottův slovník naučný a zásobuje ho potřebnými pravidly. Je to rajská země, ve které létají pečené části vět do úst. A ani od mocné Interpunkce nemohou být Smyšlené texty ovládány – takřka nepravopisný život.

Jednoho dne se jeden malý řádek smyšleného textu rozhodl, jmenoval se Lorem Ipsum, vyjít si do rozlehlé gramatiky. Velký Oxmox mu to rozmlouval, jelikož se to tam hemží zlými Čárkami, divokými Otazníky a lstivými Středníky, ale Smyšlený textík se nenechal zmátnout. Zbalil si jeho Verzálky (Velká písmena), strčil si jeho Iniciály za opasek a dal se na cestu.

Jakmile se vyšplhal na první pahorek Kurziva pohoří, podíval se naposledy na siluetu rodného města Písmenkova, nápisu Abecedyves a řádku jeho vlastní ulice, uličky Řádková. Lítostně mu tekla rétorická Otázka po tváři, pak pokračoval v cestě. Po cestě potkal Průklep.

Průklep varoval Smyšlený textík že tam, odkud on přichází, by byl nekonečně opisován a vše co by z jeho původu zbylo, by bylo slovo „a“ a tak se má Smyšlený textík otočit a opět se vrátit do vlastní, bezpečné země. Ale všechny dobré rady ho nemohly přesvědčit a tak netrvalo dlouho, až ho pár zákeřných reklamních textařů vyslídilo, s Longe a Parole ho opili a zavlékli do jejich tiskové kanceláře, kde ho pro jejich návrhy znovu a znovu zneužívali. A když nebyl přepsán, tak ho používají dodnes.

Daleko, za Slovnímy horami, vzdálené od země samohlásek a souhlásek žijí Smyšlené texty. Opuštěné žijí v Písmenkově na pobřeží Sémantiky, velkého Jazykooceánu. Místem protéká potůček zvaný Ottův slovník naučný a zásobuje ho potřebnými pravidly. Je to rajská země, ve které létají pečené části vět do úst. A ani od mocné Interpunkce nemohou být Smyšlené texty ovládány – takřka nepravopisný život.

Jednoho dne se jeden malý řádek smyšleného textu rozhodl, jmenoval se Lorem Ipsum, vyjít si do rozlehlé gramatiky. Velký Oxmox mu to rozmlouval, jelikož se to tam hemží zlými Čárkami, divokými Otazníky a lstivými Středníky, ale Smyšlený textík se nenechal zmátnout. Zbalil si jeho Verzálky (Velká písmena), strčil si jeho Iniciály za opasek a dal se na cestu. Jakmile se vyšplhal na první pahorek Kurziva pohoří, podíval se naposledy na siluetu rodného města Písmenkova, nápisu Abecedyves a řádku jeho vlastní ulice, uličky Řádková.
